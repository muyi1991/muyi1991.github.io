---
layout: post
title: 一个故事告诉你比特币的原理和运作机制
categories: [区块链]
tags: [Blockchain,Bitcoin]
date: 2017-10-01 15:12:18
comments: true
---

#### 介绍

这篇文章比较科普，尽量用类比的方法将比特币的基本原理讲出来，不会涉及算法和协议中比较细节部分。

文中我们给出一个虚拟村庄“比特村”，以讲故事方式，一步步告诉大家比特币为什么会产生、比特币解决了什么问题、比特币的目标和设计。

我们先从比特币产生的动机开始。

#### 物物交换

很久以前，有一个叫比特村的小村庄，村庄与世隔绝，有几百户人家，过着自给自足的生活。

村民以物换物，并没有使用统一货币。

基本上就是老张拿一袋面粉换老李一只羊，王大嫂拿一筐野果换刘大婶两尺布。

![](http://p8r45ciyt.bkt.clouddn.com/01.png)

#### 实物货币

终于有一天村民都觉得以物易物太不方便，于是开会便有人提出用容易分割且稀有的东西作为一般等价物，如：黄金。

把黄金和其他物品关系对应起来：一克黄金对应一只羊，一克黄金对应一袋面粉。就不用再扛着一袋面粉去换羊，带着一克黄金就行了，这样黄金就可以换取任何和一克黄金等值的物品了。

![](http://p8r45ciyt.bkt.clouddn.com/02.png)

#### 符号货币

由于村子附近金矿并不多，开采和冶炼费事费力，并且使用过程中金子不断磨损，丢失而发生损耗，弊端越来越多。

于是大家商量对策时有人提出并不一定要用真实的黄金，可以找一张纸写上“一克黄金”，只要大家都认同这张纸等于一克黄金，问题就解决了。不过也有人提出说如果每个人随便写一张都可以，那不是成了拼谁家纸多么？

不过此时又有人提出解决方案：我们都认识老村长的字，让德高望重的老村长来写。同时按照每家黄金存量发给大家等量纸，收走等量黄金作为抵押。此时就可以拿着这些纸进行交易了，大家都认识村长的字，其他人无法伪造。

老村长承诺如果想要换成黄金，把纸拿来随时换，由于是按照一张纸对应一克黄金严格比例写的，所以每张纸都能换回相应的真黄金。并且磨损严重的话，也可以兑换新的等值纸张。

此时就进入了符号货币时代，老村长承担了政府和银行的角色。

![](http://p8r45ciyt.bkt.clouddn.com/03.png)

#### 中央系统虚拟货币

过了几年，由于村长每天核对旧纸币，写新币，做账户记录非常劳累，不幸驾鹤西去了。

此时村长儿子二狗子自告奋勇承担货币发行责任。年轻的二狗子很聪明，他发现好像也不用真的写那么多纸。完全可以这样：把村民纸币都交上来销毁，记录下每户的纸币数量，进行付钱时，例如老张要拿一克黄金向老李换一只羊，就一起给二狗子打电话，说明将老张名下一克黄金划到老李名下，然后老张的名下减一克，老李名下加一克，就完成支付了。

此时村民都不需要实物支付，支付过程变成了二狗子那边维护的账本上数字的变更。

![](http://p8r45ciyt.bkt.clouddn.com/04.png)

#### 分布式虚拟货币

不久后的一天二狗子头脑一热，私自从老张账下划了十克金子到自己名下，没想到老张平时也有记账的习惯，有一次付钱被二狗子告知没钱了，于是东窗事发，二狗子被弹劾了，比特村炸开了锅。

不过大家发现了账本集中在一个人手里就完全依赖账本持有人的个人信用，如果这个人随意篡改账本或者这个人家里失火、被窃，整个体系就会崩溃。

正当人们不知所措的时候，村里一个叫中本聪的人告诉大家他已经设计了一套不依赖任何中央处理人叫比特币的虚拟货币系统可以解决以上问题。

然后讲述了自己的方案。

#### 基础设置搭建
<<<<<<< HEAD


=======
>>>>>>> parent of 91bbb2a... 423
##### 账薄公开机制

对现有账薄进行如下改造：

1.账薄上只记录每一笔交易信息：付款人、收款人，付款金额，不再记录余额。只要帐薄初始状态确定，交易可靠有时序，当前每人持有多少钱可以推算出来。

2.账薄由私有改为公开，任何时间村民想要完整的帐薄都可以获得，帐薄上记录了从创建开始到当前所有交易记录。

说到这里，村民觉得第二条不可以接受，如果这样交易信息都暴露了，没有了隐私。
中本聪不慌不忙，拿出了一些奇怪的东西。


##### 身份与签名机制（公钥加密系统）

中本聪对大家说，这套机制下，所有人都不用真实身份交易，使用一个唯一的代号。

他展示了拿出的东西，说一个叫保密印章，一个叫印章扫描器，村里每一户都会发一个保密印章和印章扫描器。作用如下：

1.保密印章：每个印章都隐藏全村唯一的一串字符，肉眼无法看出，也无法通过观察伪造。

2.印章扫描器：可以扫描某个已经盖好的章，读出隐含信息，显示在液晶屏上一串字符。

<<<<<<< HEAD
这样大家就可以不暴露真实身份进行交易了，印章隐含的一串字符就是这户人家代号。如何具体使用等会说。

##### 成立矿工组织(挖矿群体)

接下来，中本聪向全村招募矿工，要求：
* 矿工以组为单位，一组可以是单户，也可以是多户
* 矿工不影响正常使用货币
* 矿工每天要花费一定时间“挖矿”，在家就可以完成
* 矿工有可能获得报酬，付出努力越多，获得报酬可能性越大
* 可以随时退出，也可以随时有新矿工加进来

很快，有一些村民假如比特币矿工组织，分成了7个组。

##### 简历初始帐薄(创世块)

下面，中本聪销毁了二狗子手里的帐薄，把抵押的所有黄金按帐薄记录余额退还给每位村民。

然后拿出一本新帐薄，为每一户默认分配一定数量比特币，但数量非常少，有些用户甚至没有获得。这些记录的付款人一栏全都是“系统”，收款人分别是每户印章对应的隐含字符，代表初始时刻。

接着中本聪说现在市面上比特币非常少，大家可以先回到黄金做货币时代，我也没有权利要求大家承认比特币，大家可以自行决定是否接受比特币。不过随着流动和矿工的活动，比特币会慢慢多起来。

#### 支付和交易

接下来以老张付给老李10个比特币为例，说下在这个体系下如何完成支付。

##### 付款人签署交易单

老张先询问到老李的标识字符串，例如是：”ABCDEFG“。同时老张也有一个标识字符串例如是：“HIJKLMN”，然后老张写了一张单子：“HIJKLMN支付10比特币给ABCDEFG”，然后用用自己的保密印章盖章后交给老李。

另外为了便于追溯这笔钱的来源，还需在单子里注明钱的来源和记在哪一页。例如这个单子里：老张的10个比特币来自系统赠送，记录在帐薄第一页。

![](http://p8r45ciyt.bkt.clouddn.com/05.png)

##### 收款人确认单据签署人

老李拿到单子后只需要用印章扫描器扫一下老张盖在单子上的保密章，如果现实字符和付款人字符一致（“HIJKLMN”），就可以确认单子确实是付款人签署的。因为其他人无法伪造印章，任何人只要扫描印章，都可以确认单子的付款人和盖章是否一致。

##### 收款人确认付款人余额

到目前，通过保密章虽然可以确认付款人签署了这份单子，但无法确认收款人是否有足够的余额支付。之前中央虚拟货币系统中，二狗子负责检查付款人余额，现在谁来负责记账和确认交易有效性呢？

中本聪设计的是分布式货币系统，不需要依赖任何中央人物，所以不会有一个或多个人负责，最终承担这份工作的事矿工组织。

老张、老李和全场其他使用比特币进行交易的村民都依赖矿工组织才能完成交易。

#### 矿工的工作

矿工的工作是整个系统的核心，也最复杂，下面介绍矿工的工作内容和目的。

##### 矿工的工具

首先每组复制一份初始帐薄，初始帐薄仅一页，记录系统第一次的赠送。

空帐薄纸。每个小组有很多帐薄纸，没有内容，仅有帐薄书写内容规则。下面是一张空帐薄纸，字段含义后面会说。

![](http://p8r45ciyt.bkt.clouddn.com/06.png)

接下来中本聪给每个组分发若干编码生成器(哈希函数)，这个东西很神奇，将填好的帐薄内容放入这个机器，机器会在帐薄纸的“本账单编号”一栏自动打印一串由“0”和“1”组成的编号，共256个。编码生成器还有如下功能：

* 生成的编号仅与帐薄纸填入内容有关，和填写人，字体，时间无关
* 内容相同的帐薄纸编号总是相同的，哪怕改一个字，编号就会面目全非
* 将一张已打印的账簿纸放入，机器会判定编号是否是有效的机器打印，并且判定编号和内容是否一致，这个编号无法伪造
* 编码生成器在打印编码时还需要将所有填入账簿纸的交易单放入，机器会扫描交易单和填入交易单的一致性，尤其是保密印章，如果发现保密印章和付款人不一致，会拒绝打印编码
* 交易单收件箱，每个矿工小组需要在门口挂一个箱子用于收集交易单
* 公告板。每个矿工小组同样需要一个公告板公示一些信息

接下来矿工就可以开始工作了。

##### 收集交易单

中本聪规定，每笔交易要将交易单给收款人，并复制一份一模一样的交易单投递到每个矿工小组收件箱。

矿工定期到收件箱把收集到交易单一并取出。

##### 填写帐薄(挖矿)

此时小组拿出一张空的帐薄纸，把这些交易填写到“交易清单”一栏，找到当前帐薄最后一页填写编号到“上一张账单编号”一栏。注意还有“幸运数字”，可以随便填一个，如：1234。然后放入编号生成器打印编号，一张帐薄就做好了。

帐薄虽然最好了，但中本聪还有个变态规定：只有编号前10个数均为0，这页帐薄纸才算有效。

想要改变编号，只能修改帐薄内容，“交易清单”和“上一张帐薄纸编号”是不能修改的，那么只能修改幸运数字。于是为了生成有效的帐薄纸，矿工就不断抄写帐薄纸，填入不同的幸运数字，然后不断重复将纸放入编码器，重复这个过程直到生成一串有效的编号。

矿工之所以干这些看似无意义的事情是因为中本聪规定了，如果你生成一张有意义的帐薄纸，并被所有挖矿小组接受了，你的挖矿小组获得50个比特币。

这也是之前说随着交易和矿工活动，比特币的数量会不断增多的原因。

![](http://p8r45ciyt.bkt.clouddn.com/07.png)

在幸运数字尝试到“533”时，系统生成了一页有效帐薄。

##### 确认帐薄(确认区块有效性)

当挖矿小组幸运的生成了一张有意义的帐薄为了得到奖励，必须立刻请其他小组确认自己的工作，前面说过，当前村里有7个挖矿组，所以这个小组必须将有效帐薄纸抄6份快马加鞭送到其他6个小组请求确认。

中本聪规定，某小组接到其他小组送来的帐薄纸时，必须立即停下手里的挖矿工作进行帐薄纸确认。

需要确认三个信息：
* 帐薄纸的编号有效
* 帐薄的前一页有效
* 交易清单有效

第一个比较简单，只要将送来的帐薄纸放入编码生成器进行验证，验证通过，则编号有效。

第二个需要将帐薄页的“上一页编号”和这个小组目前保存的有效帐薄最后一页编号对比，如果相同则确认，不同则需要顺着已有帐薄向前对比，找到这个编号则有效。未找到则不予确认。

注：如果各小组手里的帐薄纸相同由上面的机制可以保证他们都能按同样的顺序装订成相同的帐薄。因为最后一张纸的编号总是依赖前面纸的编号，编码生成器的机制保证了所有合法帐薄纸的相对先后顺序在每个小组那里都是相同的(可能会有分支，但不会出现循环)

![](http://p8r45ciyt.bkt.clouddn.com/08.png)

如何确认交易清单有效，其实也就是确认每笔交易的付款人由足够的余额来支付。由于交易信息包含这笔钱如何来的，还包含记录来源交易的账单编号。例如：B要给C10个比特币，并注明10个比特币来自A。确认时先确认之前这笔交易是否存在，同时检查B在这之前有没有将10个比特币支付给别人。这一切确认后，这笔交易有效性就被确认了。

其中第一笔是系统奖励生成这也帐薄小组的50个，这笔交易大家都默认承认，后面只要按照上述方法追溯，就可以确认B是否当前由10个币人币支付给C。

若这三个验证全部通过，这个小组就认可了上述帐薄纸有效，然后将这张帐薄纸并入小组的主帐薄，舍弃目前进行的工作，后面的挖矿基于这本更新后主帐薄进行。

###### 帐薄确认反馈

挖矿小组送出有效帐薄纸后如果收到其他小组送来的帐薄纸，其“上一页帐薄纸编号”为自己之前送出去的帐薄纸，那么就表示他们的工作被其他小组认可，此时，可以粗略的说已经得到了50个比特币。

另外，任何一个小组生成有效帐薄纸或确认了别的小组的帐薄纸需要将这个被小组承认的交易写到公告牌上，那么收款人只要发现相关交易被各个小组确认了，基本上就可以认为这笔钱已经到自己帐上了。后面他就可以在付款时将前的来源指向这笔交易了。

以上就是整个比特币的支付体系。下面我们来分析一下这个体系可能面临的风险。


#### 工作机制分析

虽然上面阐述了比特币的运作规则，但是村民们还是有不少疑问，中本聪同学还是专门开了答疑会解答村民的疑问。

##### 如果同时收到两份合法帐薄怎么办？



##### 挖矿小组伪造帐薄怎么办？



##### 比特币一直增加下去，岂不会通货膨胀



##### 没有奖励后就没有了矿工，岂不是没人确认交易了



##### 矿工越来越多，比特币生成速度会变快么？



##### 随人代号匿名，如果某人代号泄露，通过公开帐薄，岂不是查出了所有账目？







=======
>>>>>>> parent of 91bbb2a... 423














